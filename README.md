# HR_Bank ğŸ‘¨â€ğŸ’¼ğŸ¢
**Batch ê¸°ë°˜ ì¸ì‚¬ ê´€ë¦¬ ì‹œìŠ¤í…œ (Open EMS)**  
> ê¸°ì—…ì˜ í•µì‹¬ ìì‚°, **ì¸ì  ìì›**ì„ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”!  
> ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” **Batch ì‹œìŠ¤í…œ** ê¸°ë°˜ìœ¼ë¡œ, ë¶€ì„œ ë° ì§ì› ì •ë³´ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ìš´ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> ë˜í•œ **ë°±ì—… ìë™í™” Â· ì´ë ¥ ê´€ë¦¬ Â· ëŒ€ì‹œë³´ë“œ ì œê³µ**ì„ í†µí•´ ê¸°ì—… ì¸ì‚¬ ê´€ë¦¬ë¥¼ ë”ìš± íš¨ê³¼ì ìœ¼ë¡œ ì§€ì›í•©ë‹ˆë‹¤. ğŸ“ŠğŸ’¼  

- **í”„ë¡œì íŠ¸ ê¸°ê°„:** 2025.09.05 ~ 2025.09.16  
- **API ëª…ì„¸ì„œ:** [Swagger UI ë°”ë¡œê°€ê¸° â†—](https://hrbank-production.up.railway.app/swagger-ui/index.html)
- **ë°°í¬ ì‚¬ì´íŠ¸:** [ë°”ë¡œê°€ê¸° â†—](https://hrbank-production.up.railway.app/swagger-ui/index.html)





# {íŒ€ì´ë¦„}

![Notion](https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion&logoColor=white) [íŒ€ í˜‘ì—… ë¬¸ì„œ ë§í¬](https://www.notion.so/2680fa6d0dae80f3b316ceff3494cfe2)

## íŒ€ì› êµ¬ì„±
| ì´ë¦„  | ì—­í•           | ì„¤ëª…                                             | GitHub ì£¼ì†Œ                              |
| --- | ----------- | ---------------------------------------------- | -------------------------------------- |
| ë‚¨í˜„ìˆ˜ | (íŒ€ì¥) ë°±ì—”ë“œ ê°œë°œì     | ì§ì› ê´€ë¦¬ ì‹œìŠ¤í…œ ì—”í‹°í‹° ì„¤ê³„ ë° êµ¬í˜„, CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•, í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ | [GitHub](https://github.com/Namsoo315) |
| ë¥˜ìŠ¹ë¯¼ | ë°±ì—”ë“œ ê°œë°œì     | ë¶€ì„œ ê´€ë¦¬ ë° ë°ì´í„° ë°±ì—… ì‹œìŠ¤í…œ ê°œë°œ, Batch ì²˜ë¦¬ ë° ìŠ¤ì¼€ì¤„ë§ ë‹´ë‹¹      | [GitHub](https://github.com/bustam00)  |
| ë°•ì¢…í˜„ | ë°±ì—”ë“œ ê°œë°œì     | ìˆ˜ì • ë¡œê·¸ ì‹œìŠ¤í…œ ê°œë°œ, ERD ì„¤ê³„ ë° ì½”ë“œ ë¦¬íŒ©í„°ë§                 | [GitHub](https://github.com/yeahlimm)  |
| ì´ì˜ˆë¦¼ | ë°±ì—”ë“œ/í”„ë¡ íŠ¸ ê°œë°œì | í”„ë¡ íŠ¸ì—”ë“œì™€ ìˆ˜ì • ìƒì„¸ ë‚´ì—­ ì¡°íšŒ ê¸°ëŠ¥ ê°œë°œ, PPT ë° ì‘ì—… íë¦„ë„ ì œì‘      | [GitHub](https://github.com/Namsoo315) |
| ë¯¼ì¬ì˜ | ë°±ì—”ë“œ/í”„ë¡ íŠ¸ ê°œë°œì | í”„ë¡ íŠ¸ì—”ë“œ ë° ë°ì´í„° ë°±ì—… ê¸°ëŠ¥ ê°œë°œ, íŒŒì¼ ìŠ¤í† ë¦¬ì§€ ì„¤ì • ë° ê´€ë¦¬          | [GitHub](https://github.com/jymin0)    |


---

## í”„ë¡œì íŠ¸ ì†Œê°œ
### HR_Bank
Batchë¡œ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” Open EMS

> ğŸ¢ ê¸°ì—…ì˜ í•µì‹¬ ìì‚°, ì¸ì  ìì›ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”!
HR BankëŠ” ì¸ì‚¬ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ Open EMS(Enterprise Management System)ì…ë‹ˆë‹¤. ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” Batch ì‹œìŠ¤í…œì„ ê¸°ë°˜ìœ¼ë¡œ ë¶€ì„œ ë° ì§ì› ì •ë³´ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ìš´ì˜í•  ìˆ˜ ìˆìœ¼ë©°, ë°±ì—… ìë™í™”, ì´ë ¥ ê´€ë¦¬, ëŒ€ì‹œë³´ë“œ ì œê³µì„ í†µí•´ ê¸°ì—… ì¸ì‚¬ ê´€ë¦¬ë¥¼ ë”ìš± íš¨ê³¼ì ìœ¼ë¡œ ì§€ì›í•©ë‹ˆë‹¤. ğŸ“ŠğŸ’¼

- **í”„ë¡œì íŠ¸ ê¸°ê°„:** 2025.09.05 ~ 2025.09.16

---
### ê¸°ìˆ  ìŠ¤íƒ
### Frontend
![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black)
![React](https://img.shields.io/badge/React-61DAFB?style=for-the-badge&logo=react&logoColor=black)

#### Backend  
![Spring Boot](https://img.shields.io/badge/SpringBoot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white)
![MapStruct](https://img.shields.io/badge/MapStruct-000000?style=for-the-badge&logo=mapstruct&logoColor=white)
![Spring Data JPA](https://img.shields.io/badge/JPA-59666C?style=for-the-badge&logo=hibernate&logoColor=white)

#### Database  
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-4169E1?style=for-the-badge&logo=postgresql&logoColor=white)
![H2](https://img.shields.io/badge/H2-004088?style=for-the-badge&logo=h2&logoColor=white)

#### CI/CD  
![Railway](https://img.shields.io/badge/Railway-0B0D0E?style=for-the-badge&logo=railway&logoColor=white)

#### í˜‘ì—… Tool  
![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=git&logoColor=white)
![GitHub](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white)
![Notion](https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion&logoColor=white)
![Discord](https://img.shields.io/badge/Discord-5865F2?style=for-the-badge&logo=discord&logoColor=white)

---
# íŒ€ì›ë³„ êµ¬í˜„ ê¸°ëŠ¥ ìƒì„¸

## ë‚¨í˜„ìˆ˜
## ì§ì› ìˆ˜ì • (Update Employee)

### ìƒí™©

* ìš´ì˜ìê°€ ì§ì› ì •ë³´ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆì–´ì•¼ í•¨.
* ì´ë¦„, ì´ë©”ì¼, ë¶€ì„œ, ì§ìœ„, ìƒíƒœ, í”„ë¡œí•„ ì´ë¯¸ì§€ ë“± ë‹¤ì–‘í•œ ì†ì„±ì´ ìˆ˜ì •ë  ìˆ˜ ìˆìŒ.
* ë³€ê²½ ì´ë ¥(ChangeLog + History)ë„ ë°˜ë“œì‹œ ë‚¨ê²¨ì•¼ ì¶”í›„ ê°ì‚¬ ê°€ëŠ¥.

### ë¬¸ì œ

* ì´ë©”ì¼ì€ ê³ ìœ í•´ì•¼ í•˜ë¯€ë¡œ ì¤‘ë³µ ê²€ì¦ í•„ìš”.
* í”„ë¡œí•„ ì´ë¯¸ì§€(BinaryContent)ëŠ” íŒŒì¼ ì €ì¥ì†Œì™€ DBë¥¼ í•¨ê»˜ ê´€ë¦¬í•´ì•¼ í•¨.
* ê¸°ì¡´ ì§ì› ë°ì´í„°ì™€ ìˆ˜ì •ëœ ë°ì´í„°ë¥¼ ë¹„êµí•´ **ì •í™•í•œ ë³€ê²½ ì´ë ¥**ì„ ë‚¨ê²¨ì•¼ í•¨.

### í–‰ë™

* Service ê³„ì¸µì—ì„œ ë‹¤ìŒì„ ìˆ˜í–‰:

  * `employeeRepository.existsByEmailAndIdNot()` ìœ¼ë¡œ ì¤‘ë³µ ì´ë©”ì¼ ê²€ì‚¬
  * íŒŒì¼ì´ í¬í•¨ë˜ë©´ BinaryContent DB ì €ì¥ + Storage ì €ì¥ ì²˜ë¦¬
  * ê¸°ì¡´ Employeeë¥¼ `toBuilder()`ë¡œ ë³µì‚¬ â†’ ë³€ê²½ ìš”ì²­ê°’ë§Œ ì—…ë°ì´íŠ¸
  * ì €ì¥ í›„, ChangeLog(Updated) + History ìƒì„± â†’ ë³€ê²½ëœ ì†ì„±ë§Œ ê¸°ë¡

```java
Employee oldEmployee = employee.toBuilder().build();
Employee updatedEmployee = employee.toBuilder()
    .name(request.name() != null ? request.name() : employee.getName())
    ...
    .build();
Employee savedEmployee = employeeRepository.save(updatedEmployee);

ChangeLog changeLog = ChangeLogUtils.createChangeLog(ChangeLogType.UPDATED, ipAddress, request.memo(), savedEmployee);
List<History> histories = ChangeLogUtils.createHistoriesForUpdate(changeLog, oldEmployee, savedEmployee);
```

### ê²°ê³¼

* ìš´ì˜ìê°€ ì•ˆì „í•˜ê²Œ ì§ì› ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŒ.
* íŒŒì¼ê³¼ DBê°€ ì¼ê´€ì„± ìˆê²Œ ì²˜ë¦¬ë¨.
* ë³€ê²½ ë‚´ì—­ì´ History í…Œì´ë¸”ì— ê¸°ë¡ë˜ì–´ ì‚¬í›„ ê°ì‚¬ ê°€ëŠ¥.

---

## ì§ì› ì‚­ì œ (Delete Employee)

### ìƒí™©

* ì§ì› ê³„ì • ì‚­ì œ ì‹œ ê´€ë ¨ ì´ë ¥ë„ ë‚¨ê²¨ì•¼ í•¨.
* í”„ë¡œí•„ ì´ë¯¸ì§€(BinaryContent)ë„ í•¨ê»˜ ì •ë¦¬í•´ì•¼ í•¨.

### ë¬¸ì œ

* ë‹¨ìˆœ ì‚­ì œ ì‹œ ì´ë ¥ ì¶”ì  ë¶ˆê°€ â†’ ëˆ„ê°€ ì–¸ì œ ì‚­ì œí–ˆëŠ”ì§€ í™•ì¸ ì–´ë ¤ì›€.
* BinaryContent orphan ë°ì´í„°(DB + íŒŒì¼)ê°€ ë‚¨ì•„ ê´€ë¦¬ ì´ìŠˆ ë°œìƒ ê°€ëŠ¥.

### í–‰ë™

* Service ê³„ì¸µì—ì„œ ë‘ ë‹¨ê³„ ì²˜ë¦¬:

  1. `deleteEmployee()`

     * BinaryContent ì¡´ì¬ ì‹œ â†’ DB ì‚­ì œ + Storage íŒŒì¼ ì‚­ì œ
     * Employee DB ì‚­ì œ
  2. `deleteEmployeeDoSaveLog()`

     * ì‚­ì œ ì „ Employee ì „ì²´ ì •ë³´ ì¡°íšŒ(`findByIdWithRelations`)
     * ChangeLog(Deleted) ìƒì„± + ì €ì¥
     * Employeeì™€ ChangeLog ê´€ê³„ í•´ì œ(`unlinkEmployee`)
     * History ìƒì„± (ì‚­ì œëœ ì§ì›ì˜ ëª¨ë“  ì£¼ìš” í•„ë“œë¥¼ before ê°’ìœ¼ë¡œ ì €ì¥)

```java
ChangeLog changeLog = ChangeLogUtils.createChangeLog(ChangeLogType.DELETED, ipAddress, null, employee);
changeLogRepository.save(changeLog);
changeLogRepository.unlinkEmployee(employee);

List<History> histories = ChangeLogUtils.createHistoriesForDelete(changeLog, employee);
historyRepository.saveAll(histories);
```

### ê²°ê³¼

* ì§ì› ì‚­ì œ ì‹œ, í”„ë¡œí•„ ì´ë¯¸ì§€ê¹Œì§€ ê¹”ë”í•˜ê²Œ ì •ë¦¬.
* ChangeLog + Historyë¥¼ í†µí•´ ì‚­ì œ ì´ë ¥ ë³´ì¡´.
* ìš´ì˜ìê°€ ì‚­ì œ í›„ì—ë„ ê³¼ê±° ë°ì´í„° ì¶”ì  ê°€ëŠ¥.
  
---
## ë¥˜ìŠ¹ë¯¼
### ë¶€ì„œ ê´€ë¦¬

### ìƒí™©
- ë¶€ì„œ CRUDë¥¼ ì¶”ê°€í•˜ì—¬ì•¼ í•¨.

### ë¬¸ì œ
- ë¶€ì„œ ì‚­ì œëŠ” ì†Œì†ëœ ì§ì›ì´ ì—†ëŠ” ê²½ìš°ì—ë§Œ ê°€ëŠ¥
- ëª©ë¡ ì¡°íšŒëŠ” ì„ íƒìœ¼ë¡œ ì¡°ê±´ì„ ë°›ê¸° ë•Œë¬¸ì— JpaRepositoryë¡œëŠ” í•œê³„ê°€ ìˆìŒ
  
### í–‰ë™
<details>
  <summary>íŒŒì¼êµ¬ì¡° ë³´ê¸°</summary>

```java
DepartmentServiceì—ì„œ ì†Œì†ëœ ì§ì›ì´ ìˆëŠ”ì§€ í™•ì¸
public void deleteById(Long id) throws IllegalStateException {  
	Department department = departmentRepository.findById(id)
	.orElseThrow(() -> new NoSuchElementException("ì‚­ì œ ëŒ€ìƒ ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤: " + id));
	List<Employee> employees= employeeRepository.findAll();  
	boolean exists = employees.stream()
	.anyMatch(e -> e.getDepartment().getId().equals(id));
	if (exists) {
	    throw new IllegalStateException("ì†Œì†ëœ ì§ì›ì´ 1ëª… ì´ìƒì´ë©´ ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤: " + id ); 
	}  
	departmentRepository.deleteById(id);
}

QueryDSLì„ ì‚¬ìš©í•´ì„œ í•„ìš”í•œ ì¡°ê±´ìœ¼ë¡œ ì¿¼ë¦¬ë¬¸ ìƒì„±
if (nameOrDescription != null && !nameOrDescription.isBlank()) {
      where.and(department.name.containsIgnoreCase(nameOrDescription)
          .or(department.description.containsIgnoreCase(nameOrDescription)));
}
if (idAfter != null) {
		where.and(department.id.gt(idAfter));
}

if (sortField.equals("name") && sortDirection.equals("asc")) {
    return queryFactory
        .select(department)
        .from(department)
        .limit(size)
        .where(where)
        .orderBy(department.name.asc())
        .fetch();
}
if (sortField.equals("name") && sortDirection.equals("desc")) {
    return queryFactory
        .select(department)
        .from(department)
        .limit(size)
        .where(where)
        .orderBy(department.name.desc())
        .fetch();
}
if (sortField.equals("establishedDate") && sortDirection.equals("desc")) {
    return queryFactory
        .select(department)
        .from(department)
        .limit(size)
        .where(where)
        .orderBy(department.establishedDate.desc())
        .fetch();
}

  return queryFactory
      .select(department)
      .from(department)
      .limit(size)
      .where(where)
      .orderBy(department.establishedDate.asc())
      .fetch();
}

```
</details>

### ê²°ê³¼

- ë¶ˆí•„ìš”í•œ ì¡°ê±´ ì œê±° â†’ ì‹¤í–‰ ì¿¼ë¦¬ ë‹¨ìˆœí™”.
- ì°¸ì¡° ë¬´ê²°ì„± ìœ ì§€
  
---

## ë¯¼ì¬ì˜
## ëŒ€ìš©ëŸ‰ ë‹¤ìš´ë¡œë“œ ìŠ¤íŠ¸ë¦¬ë° (ë©”ëª¨ë¦¬ OOM ë°©ì§€)

### ìƒí™©

* ë°±ì—… CSV íŒŒì¼, í”„ë¡œí•„ ì´ë¯¸ì§€ ë“± ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì•ˆì •ì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œí•´ì•¼ í•¨.
* ì„œë²„ ë©”ëª¨ë¦¬ ì‚¬ìš© ê¸‰ì¦ ì—†ì´ ë‹¤ìˆ˜ ë™ì‹œ ë‹¤ìš´ë¡œë“œë„ ê²¬ë”œ ìˆ˜ ìˆì–´ì•¼ í•¨.

### ë¬¸ì œ

* byte[] ê¸°ë°˜ ì‘ë‹µì€ íŒŒì¼ ì „ì²´ë¥¼ ë©”ëª¨ë¦¬ì— ì ì¬ -> **OOM/GC** ë¶€ë‹´ ë° ì‘ë‹µ ì§€ì—°
* í•„ìš” ì‹œ ë¸Œë¼ìš°ì €ì—ì„œ íŒŒì¼ëª…, ìš©ëŸ‰ ì •ë³´ í‘œì‹œí•¨.

### í–‰ë™

* InputStreamResourceë¥¼ ì‚¬ìš©í•œ **ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ**ìœ¼ë¡œ ì „í™˜
* Content-Disposition/Content-Type/Content-Length í—¤ë”ë¥¼ ì •í™•íˆ ì„¸íŒ…
* íŒŒì¼ ì‹¤ì²´ëŠ” LocalBinaryContentStoragì—ì„œ InputStreamìœ¼ë¡œ ë°”ë¡œ ì½ì–´ ì „ì†¡

```java
// LocalBinaryContentStorage
@Override
  public InputStream getFile(Long binaryContentId) {
    Path filePath = findFileById(binaryContentId);
    if (filePath == null || Files.notExists(filePath)) {
      throw new NoSuchElementException("keyê°€" + binaryContentId + "ì¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
    try {
      return Files.newInputStream(filePath);
    } catch (IOException e) {
      e.printStackTrace();
      throw new RuntimeException(e);
    }
  }
  
@Override
  public ResponseEntity<Resource> downloadFile(BinaryContentDTO metaData) {
    InputStream inputStream = getFile(metaData.id());
    Resource resource = new InputStreamResource(inputStream);

    return ResponseEntity.status(HttpStatus.OK)
        .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + metaData.name() + "\"")
        .header(HttpHeaders.CONTENT_TYPE, metaData.contentType())
        .header(HttpHeaders.CONTENT_LENGTH, String.valueOf(metaData.size())).body(resource);
  }

// BinaryContentServiceImpl
@Override
  public ResponseEntity<Resource> downloadBinaryContent(Long id) {
    BinaryContentDTO dto = getBinaryContent(id);
    return storage.downloadFile(dto);
  }
```

### ê²°ê³¼

* ë©”ëª¨ë¦¬ ì‚¬ìš©ì´ íŒŒì¼ í¬ê¸° ì˜ì¡´ -> ë²„í¼ í¬ê¸° ìˆ˜ì¤€ìœ¼ë¡œ ê°ì†Œ, **OOM ë°©ì§€**
* ë‹¤ìš´ë¡œë“œ ì‹œì‘ ì§€ì—° ë‹¨ì¶•
* ë¸Œë¼ìš°ì € íŒŒì¼ëª… í‘œì‹œ ê°€ëŠ¥

---

## ë°•ì¢…í˜„
## í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ (ChangeLog)

### ìƒí™©

- ëŒ€ëŸ‰ ë°ì´í„°ì—ì„œë„ ì•ˆì •ì ì¸ í˜ì´ì§€ë„¤ì´ì…˜ ì •ë ¬ í•„ìš”.

### ë¬¸ì œ

- í˜ì´ì§€ë„¤ì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì „ì²´ ì¿¼ë¦¬ë¥¼ í•­ìƒ êµ¬í•´ì™€ ì„±ëŠ¥ì ìœ¼ë¡œ ë–¨ì–´ì§
- ChangeLog, Historiesê°™ì€ ë°ì´í„°ëŠ” ë§ì´ ìŒ“ì´ë¯€ë¡œ í˜ì´ì§€ë³„ë¡œ êµ¬í•´ì˜¤ëŠ” ê³¼ì •ì´ í•„ìš”í•¨.

### í–‰ë™

- Service
    - Repositoryì˜ ê²€ìƒ‰ ê²°ê³¼ë¥¼ size + 1ë¡œ ì¡°íšŒ, hasNext íŒë³„ í›„ ìë¥´ê¸°
    - ë§ˆì§€ë§‰ ìš”ì†Œì˜ `id` ë‹¤ìŒ ì»¤ì„œë¡œ ì‚¬ìš©: `nextCursor = {"id": <lastId>}` ë¬¸ìì—´ ìƒì„±

<details>
  <summary>searchChangeLogs ë©”ì„œë“œ ë³´ê¸°</summary>

```java
@Override
public CursorPageResponse<ChangeLogDTO> searchChangeLogs(
    String employeeNumber, String memo, String ipAddress, ChangeLogType type, Instant atFrom, Instant atTo, Long idAfter,
    String cursor, int size, String sortField, String sortDirection) {

  List<ChangeLog> changeLogs = changeLogRepository.searchChangeLogs(
      employeeNumber, memo, ipAddress, type, atFrom, atTo, idAfter, size + 1, sortField, sortDirection);
  boolean hasNext = changeLogs.size() > size;
  if(hasNext) changeLogs = changeLogs.subList(0, size);

  List<ChangeLogDTO> dtos = changeLogs.stream()
      .map(changeLogMapper::toDto)
      .toList();

  Long nextIdAfter = hasNext ? dtos.get(dtos.size() - 1).id() : null;
  long totalCount = changeLogRepository.countChangeLogs(employeeNumber, memo, ipAddress, type, atFrom, atTo);

  return CursorPageResponse.<ChangeLogDTO>builder()
      .content(dtos)
      .nextCursor(nextIdAfter != null ? ("{\"id\":" + nextIdAfter + "}") : null)
      .nextIdAfter(nextIdAfter)
      .size(size)
      .totalElements(totalCount)
      .hasNext(hasNext)
      .build();
}
```
</details> 

### ê²°ê³¼

- ìš´ì˜ìê°€ ì›í•˜ëŠ” ì¡°ê±´ìœ¼ë¡œ ì•ˆì •ì ì¸ ì´ë ¥ ì¡°íšŒ ê°€ëŠ¥.
- ì»¤ì„œ ë°©ì‹ìœ¼ë¡œ ìŠ¤í¬ë¡¤í˜• í˜ì´ì§€ë„¤ì´ì…˜ ì‹œ ì‘ë‹µ ì•ˆì •ì„± í™•ë³´.
  
## íŒŒì¼ êµ¬ì¡°
<details>
  <summary>íŒŒì¼êµ¬ì¡° ë³´ê¸°</summary>
 
```
â”œâ”€src
  â”œâ”€main
  â”‚  â”œâ”€java
  â”‚  â”‚  â””â”€com
  â”‚  â”‚      â””â”€codeit
  â”‚  â”‚          â””â”€hrbank
  â”‚  â”‚              â”‚  HrBankApplication.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€config
  â”‚  â”‚              â”‚      OpenApiConfig.java
  â”‚  â”‚              â”‚      QuerydslConfig.java
  â”‚  â”‚              â”‚      WebConfig.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€controller
  â”‚  â”‚              â”‚      BackupController.java
  â”‚  â”‚              â”‚      BinaryContentController.java
  â”‚  â”‚              â”‚      ChangeLogController.java
  â”‚  â”‚              â”‚      DepartmentController.java
  â”‚  â”‚              â”‚      DownloadController.java
  â”‚  â”‚              â”‚      EmployeeController.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€dto
  â”‚  â”‚              â”‚  â”œâ”€data
  â”‚  â”‚              â”‚  â”‚      BackupDTO.java
  â”‚  â”‚              â”‚  â”‚      BinaryContentDTO.java
  â”‚  â”‚              â”‚  â”‚      ChangeLogDTO.java
  â”‚  â”‚              â”‚  â”‚      DepartmentDTO.java
  â”‚  â”‚              â”‚  â”‚      EmployeeDistributionDTO.java
  â”‚  â”‚              â”‚  â”‚      EmployeeDTO.java
  â”‚  â”‚              â”‚  â”‚      EmployeeTrendDTO.java
  â”‚  â”‚              â”‚  â”‚      HistoryDTO.java
  â”‚  â”‚              â”‚  â”‚
  â”‚  â”‚              â”‚  â”œâ”€request
  â”‚  â”‚              â”‚  â”‚      BinaryContentCreateRequest.java
  â”‚  â”‚              â”‚  â”‚      BinaryContentUpdateRequest.java
  â”‚  â”‚              â”‚  â”‚      DepartmentCreateRequest.java
  â”‚  â”‚              â”‚  â”‚      DepartmentUpdateRequest.java
  â”‚  â”‚              â”‚  â”‚      EmployeeCreateRequest.java
  â”‚  â”‚              â”‚  â”‚      EmployeeUpdateRequest.java
  â”‚  â”‚              â”‚  â”‚      HistoryCreateRequest.java
  â”‚  â”‚              â”‚  â”‚      HistoryUpdateRequest.java
  â”‚  â”‚              â”‚  â”‚
  â”‚  â”‚              â”‚  â””â”€response
  â”‚  â”‚              â”‚          CursorPageResponse.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€entity
  â”‚  â”‚              â”‚      Backup.java
  â”‚  â”‚              â”‚      BackupStatus.java
  â”‚  â”‚              â”‚      BinaryContent.java
  â”‚  â”‚              â”‚      ChangeLog.java
  â”‚  â”‚              â”‚      ChangeLogType.java
  â”‚  â”‚              â”‚      DateUnit.java
  â”‚  â”‚              â”‚      Department.java
  â”‚  â”‚              â”‚      Employee.java
  â”‚  â”‚              â”‚      EmployeeGroupBy.java
  â”‚  â”‚              â”‚      EmployeeStatus.java
  â”‚  â”‚              â”‚      History.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€exception
  â”‚  â”‚              â”‚      GlobalExceptionHandler.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€mapper
  â”‚  â”‚              â”‚      BackupMapper.java
  â”‚  â”‚              â”‚      BinaryContentMapper.java
  â”‚  â”‚              â”‚      ChangeLogMapper.java
  â”‚  â”‚              â”‚      DepartmentMapper.java
  â”‚  â”‚              â”‚      EmployeeMapper.java
  â”‚  â”‚              â”‚      HistoryMapper.java
  â”‚  â”‚              â”‚      PageResponseMapper.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€repository
  â”‚  â”‚              â”‚  â”‚  BackupQueryRepository.java
  â”‚  â”‚              â”‚  â”‚  BackupRepository.java
  â”‚  â”‚              â”‚  â”‚  BinaryContentRepository.java
  â”‚  â”‚              â”‚  â”‚  ChangeLogQueryRepository.java
  â”‚  â”‚              â”‚  â”‚  ChangeLogRepository.java
  â”‚  â”‚              â”‚  â”‚  DepartmentQueryRepository.java
  â”‚  â”‚              â”‚  â”‚  DepartmentRepository.java
  â”‚  â”‚              â”‚  â”‚  EmployeeQueryRepository.java
  â”‚  â”‚              â”‚  â”‚  EmployeeRepository.java
  â”‚  â”‚              â”‚  â”‚  HistoryRepository.java
  â”‚  â”‚              â”‚  â”‚
  â”‚  â”‚              â”‚  â””â”€impl
  â”‚  â”‚              â”‚          BackupQueryRepositoryImpl.java
  â”‚  â”‚              â”‚          ChangeLogQueryRepositoryImpl.java
  â”‚  â”‚              â”‚          DepartmentQueryRepositoryImpl.java
  â”‚  â”‚              â”‚          EmployeeQueryRepositoryImpl.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€scheduler
  â”‚  â”‚              â”‚      MyScheduler.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€service
  â”‚  â”‚              â”‚  â”‚  BackupService.java
  â”‚  â”‚              â”‚  â”‚  BinaryContentService.java
  â”‚  â”‚              â”‚  â”‚  ChangeLogService.java
  â”‚  â”‚              â”‚  â”‚  DepartmentService.java
  â”‚  â”‚              â”‚  â”‚  EmployeeAnalyticsService.java
  â”‚  â”‚              â”‚  â”‚  EmployeeService.java
  â”‚  â”‚              â”‚  â”‚
  â”‚  â”‚              â”‚  â”œâ”€csv
  â”‚  â”‚              â”‚  â”‚      CsvExportService.java
  â”‚  â”‚              â”‚  â”‚
  â”‚  â”‚              â”‚  â””â”€impl
  â”‚  â”‚              â”‚          BackupServiceImpl.java
  â”‚  â”‚              â”‚          BinaryContentServiceImpl.java
  â”‚  â”‚              â”‚          ChangeLogServiceImpl.java
  â”‚  â”‚              â”‚          DepartmentServiceImpl.java
  â”‚  â”‚              â”‚          EmployeeAnalyticsServiceImpl.java
  â”‚  â”‚              â”‚          EmployeeServiceImpl.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â”œâ”€storage
  â”‚  â”‚              â”‚  â”‚  BinaryContentStorage.java
  â”‚  â”‚              â”‚  â”‚
  â”‚  â”‚              â”‚  â””â”€type
  â”‚  â”‚              â”‚          LocalBinaryContentStorage.java
  â”‚  â”‚              â”‚
  â”‚  â”‚              â””â”€util
  â”‚  â”‚                      ChangeLogUtils.java
  â”‚  â”‚
  â”‚  â””â”€resources
  â”‚        application-dev.yml
  â”‚        application-prod.yml
  â”‚        application.yml
  â”‚        schema.sql
  â”‚      
  â”‚      
  â””â”€test
      â””â”€java
          â””â”€com
              â””â”€codeit
                  â””â”€hrbank
                          HrBankApplicationTests.java
```
</details>

--- 

## ì´ì˜ˆë¦¼
## ëŒ€ì‹œë³´ë“œ_ê¸°ê°„ ë‹¨ìœ„ë³„ ì§ì› ìˆ˜ ì§‘ê³„

### ìƒí™©

* ì¼/ì£¼/ì›”/ë¶„ê¸°/ë…„ ë‹¨ìœ„ë¡œ ë²„í‚·(ê¸°ê°„ ë‹¨ìœ„ ë¬¶ìŒ)ì„ ë§Œë“¤ì–´ ê° êµ¬ê°„ì˜ ì§ì›ìˆ˜ ì¶”ì´ë¥¼ ê³„ì‚°í•´ì•¼ í•¨.

### ë¬¸ì œ

* ë§ˆì§€ë§‰ ë²„í‚·ì˜ ë ê²½ê³„ê°€ toë¥¼ ë„˜ê±°ë‚˜ ëª¨ìë¼ì„œ í•˜ë£¨ê°€ ì¤‘ë³µ/ëˆ„ë½ë˜ëŠ” ì‚¬ë¡€ ë°œìƒ -> ê·¸ë˜í”„ê°€ í•œ ì¹¸ ë°€ë¦¬ê±°ë‚˜ ê°’ì´ ê³¼ì†Œ/ê³¼ëŒ€ ì§‘ê³„ë¨

### í–‰ë™

* ë§ˆì§€ë§‰ ë²„í‚·ë§Œ endExclusive = toDate.plusDays(1)ë¡œ ë³´ì •í•˜ê³ , ìŠ¤ëƒ…ìƒ· ê¸°ì¤€ì¼ì„ ref = endExclusive.minusDays(1)ë¡œ í†µì¼
  
  ```java
	LocalDate nextStart = bump(start, dateUnit);
	LocalDate endExclusive = (i + 1 < starts.size()) ? nextStart : toDate.plusDays(1);
	LocalDate ref = endExclusive.minusDays(1); // êµ¬ê°„ ë í•˜ë£¨
	counts.add(employeeRepository.countEmployeesAt(ref));
  ```

### ê²°ê³¼

* ì›”/ë¶„ê¸°ì˜ ì´ˆë°˜ê³¼ ë§ì— ê°’ì´ íŠ€ë˜ í˜„ìƒ ì œê±°
* ê·¸ë˜í”„ ì•ˆì •ì„± â†‘
  
---

## ëŒ€ì‹œë³´ë“œ_ë¶€ì„œë³„ ì§ì› ë¶„í¬ ì§‘ê³„

### ìƒí™©

* ëŒ€ì‹œë³´ë“œì— ë¶€ì„œë³„ ì§ì› ë¶„í¬ë¥¼ ë³´ì—¬ì¤˜ì•¼ í•¨.

### ë¬¸ì œ

* ë¶€ì„œë³„
	* ì´ˆê¸°ì—ëŠ” ê° ë¶€ì„œë§ˆë‹¤ employeeRepository.countByDepartmentAndStatus() ì¿¼ë¦¬ë¥¼ ë”°ë¡œ í˜¸ì¶œë˜ëŠ” N+1 ë¬¸ì œ ë°œìƒ 
  	* ê²°ê³¼ì ìœ¼ë¡œ DB ë¶€í•˜ ì¦ê°€ ë° ì‘ë‹µ ì†ë„ ëŠë ¤ì§


 ### í–‰ë™
 
* ë¶€ì„œë³„
  * ëª¨ë“  ë¶€ì„œ IDë¥¼ í•œ ë²ˆì— ëª¨ì•„ì„œ ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ì¹´ìš´íŠ¸ ê°€ì ¸ì˜¤ë„ë¡ ë³€ê²½
  * ID ì§‘í•©ìœ¼ë¡œ ëª¨ì•„ í•œë²ˆì— group by ì¡°íšŒ

	```java
	Set<Long> deptIds = new HashSet<>();
	departments.forEach(d -> deptIds.add(d.getId()));
	Map<Long, Long> counts = employeeRepository.countEmployeesByDepartmentIds(status, deptIds);
	  ```

### ê²°ê³¼
* ì¿¼ë¦¬ í˜¸ì¶œ ìˆ˜ 1íšŒë¡œ ë‹¨ì¶•
* ì‘ë‹µ ì†ë„ ê°œì…˜
* ë¶€ì„œ ê°œìˆ˜ê°€ ëŠ˜ì–´ë‚˜ë„ ì„±ëŠ¥ ì•ˆì •ì  ìœ ì§€
  
---

## êµ¬í˜„ í™ˆí˜ì´ì§€
- ì‹¤ì œ ë°°í¬ ì‚¬ì´íŠ¸ : [https://hrbank-production.up.rail](https://hrbank-production.up.railway.app/swagger-ui/index.html)
- ë°°í¬ Swagger :  [Swagger](https://hrbank-production.up.railway.app/swagger-ui/index.html)

## í”„ë¡œì íŠ¸ íšŒê³ ë¡
(ì œì‘í•œ ë°œí‘œìë£Œ ë§í¬ í˜¹ì€ ì²¨ë¶€íŒŒì¼)
